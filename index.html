<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Receiptkit by rjstelling</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Receiptkit</h1>
        <h2>Simple StoreKit receipt validation and processing.</h2>
        <a href="https://github.com/rjstelling/ReceiptKit" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="receiptkit" class="anchor" href="#receiptkit"><span class="octicon octicon-link"></span></a>ReceiptKit</h1>

<p>Simple StoreKit receipt validation and processing for iOS 7. This only supports the universal receipt format.</p>

<p>Follow the <a href="http://twitter.com/receiptkit">ReceiptKit Twitter account</a> for code updates and news.</p>

<h2>
<a name="receipt-data" class="anchor" href="#receipt-data"><span class="octicon octicon-link"></span></a>Receipt Data</h2>

<p>Under iOS 7 receipt data can be accessed like this:</p>

<pre><code>NSURL *receiptURL = [[NSBundle mainBundle] appStoreReceiptURL];
NSData *receipt = [NSData dataWithContentsOfURL:receiptURL];
</code></pre>

<h2>
<a name="apple-root-certificate" class="anchor" href="#apple-root-certificate"><span class="octicon octicon-link"></span></a>Apple Root Certificate</h2>

<p>You should download your own version of the CA root certificate:</p>

<p>See: <a href="http://www.apple.com/certificateauthority/">http://www.apple.com/certificateauthority/</a></p>

<p>Certificate can be found here: <a href="http://www.apple.com/appleca/AppleIncRootCertificate.cer">http://www.apple.com/appleca/AppleIncRootCertificate.cer</a></p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>To verify a receipt and decode the payload:</p>

<pre><code>NSData *receipt = ..., cert = ...
RTKReceiptParser *parser = [[RTKReceiptParser alloc] initWithReceipt:receipt certificate:cert];
BOOL isBundleIDValid = [parser isReceiptValidForDevice:@"com.example-corp.app-name"];
</code></pre>

<p>Access the purchase info:</p>

<pre><code>parser.purchaseInfo
</code></pre>

<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p>This is just a stand alone project for now. You should replace the receipt file with your own to test it. </p>

<p><code>isReceiptValidForDevice:</code> returns a BOOL if the receipt data is valid and accessing <code>purchaseInfo</code> will create an <code>RTKPurchaseInformation</code> object.
The properties of this object can be used to query the receipt and any in-app purchases (IAP).</p>

<p>Let me know any issues or questions; <a href="mailto:richard@empiricalmagic.com">richard@empiricalmagic.com</a> or <a href="http://twitter.com/rjstelling">@rjstelling</a></p>

<h2>
<a name="openssl" class="anchor" href="#openssl"><span class="octicon octicon-link"></span></a>OpenSSL</h2>

<p><strong>WARNING</strong>: You <em>must</em> compile your own versions of libssl and libcrypto. </p>

<h2>
<a name="known-issues" class="anchor" href="#known-issues"><span class="octicon octicon-link"></span></a>Known Issues</h2>

<ul>
<li>Will not run under 64-bit Simulator in Xcode 5. Missing OpenSSL symbols. </li>
</ul><h2>
<a name="creating-your-own-demo-app" class="anchor" href="#creating-your-own-demo-app"><span class="octicon octicon-link"></span></a>Creating Your Own Demo App</h2>

<p>In App Purchases (IPA) are tied to an apps bundle identifier and need to be set up on <a href="https://itunesconnect.apple.com">iTunes Connect</a>. In addition you cannot user the Simulator to test the purchase and receipt refresh. The only real way to test IAP is to set up an app of your own. </p>

<h3>
<a name="creating-test-users" class="anchor" href="#creating-test-users"><span class="octicon octicon-link"></span></a>Creating Test Users</h3>

<p>While developing your app any IAP will be performed with in the <code>[Sandbox]</code>. Conection to the sandbox is handled automaticly when you app it complied with a development provisioning profile. </p>

<p><img src="images/itunes-dash.png" alt="iTunes Connect Dashboard"></p>

<p>Log into iThues Connect and click on the "Manage Users" link.</p>

<p><img src="images/itunes-test-user.png" alt="Manage User - iTunes Connect"></p>

<p>Click on the "Test User" button.</p>

<p><img src="images/itunes-add-user.png" alt="Test Users"></p>

<p>Click on the "Add User" button in the top right.</p>

<p><img src="images/add-new-user.png" alt="Add New User"></p>

<p>Fill in the "Add New User" form, the password requirements are the same as for the production store.</p>

<p><img src="images/log-out-on-device.png" alt="Log Out, On Device"></p>

<p>On the device you will be testing with you <em>must</em> log out of the App Store. This can be done in <code>Setting.app &gt; iTunes &amp; App Store</code>, tap the <code>Apple ID</code> and then <code>Sign Out</code>.</p>

<p><strong>DO NOT</strong> sign in with the newly created test user. We will sign in from within the ReceiptKit test app.</p>

<h3>
<a name="create-in-app-purchase" class="anchor" href="#create-in-app-purchase"><span class="octicon octicon-link"></span></a>Create In App Purchase</h3>

<p><img src="images/ReceiptKit.png" alt="ReceiptKit App"></p>

<p>Either create an app for testing ReceiptKit or from with in the app you intend to incorporate ReceiptKit into, click the "Manage In App Purchases" button.</p>

<p><img src="images/create-new.png" alt="Create New IAP"></p>

<p><img src="images/iap.png" alt="In App Purchases"></p>

<p>If you want to use ReceiptKit demo app then you need to create 2 IAP called <code>consumable01</code> and <code>nonconsumable01</code>. You can give these any display name, cost and description as you like but "Product IDs" neewd to be; <code>consumable01</code> and <code>nonconsumable01</code>.</p>

<h3>
<a name="compiling-receiptkit-demo-app" class="anchor" href="#compiling-receiptkit-demo-app"><span class="octicon octicon-link"></span></a>Compiling ReceiptKit Demo App</h3>

<ol>
<li>Remember to change the bundle identifer to match that of the app you have created</li>
<li>Sign out of the App Store (see above) on your test device</li>
<li>Create a test user (if you have not already, see above)</li>
<li>Run the app on the test device</li>
<li>If you have set up the IAP correctly the display names, cost and description will be loaded into the app</li>
<li>Tapping a button next to an IAP will prompt you to sign in:
-- <img src="images/sign-in.png" alt="Sign in">
</li>
<li>Tap "Use Existing Apple ID" and enter the email and password of the test user set up above
-- <img src="images/apple-id.png" alt="Apple ID">
</li>
<li>If all is working the App will ask you to confirm the purchase (in Sandbox mode)
-- <img src="images/confirm-purchase.png" alt="Confirm IAP">
</li>
<li>If no errors occur you can tap "Check Receipt" to validate the receipt (you can only do this once per session unless you compile your own version of OpenSSL).</li>
<li>Tap "View Receipt" to see some info about the receipt.</li>
</ol><h3>
<a name="got-yas" class="anchor" href="#got-yas"><span class="octicon octicon-link"></span></a>Got-Yas</h3>

<ol>
<li>If you create a consumable IAP this wil be removed form the receipt if you refresh the receipt. </li>
</ol>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/rjstelling/ReceiptKit/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/rjstelling/ReceiptKit/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/rjstelling/ReceiptKit"></a> is maintained by <a href="https://github.com/rjstelling">rjstelling</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
